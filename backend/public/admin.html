<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
  <link rel="stylesheet" href="./assets/styles.css" />

  <!-- üîí –†–æ–ª–µ–≤–æ–π –≥–∞—Ä–¥: –Ω–µ-–∞–¥–º–∏–Ω–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ /staff -->
  <script>
  (function(){
    function getInitHeaders(){
      try {
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData) {
          return { "X-TG-INIT-DATA": window.Telegram.WebApp.initData };
        }
      } catch(_) {}
      return {};
    }

    async function guard() {
      try {
        const headers = getInitHeaders();
        const res = await fetch("/api/me", { headers });
        if (!res.ok) return; // –≤–Ω–µ Telegram –∏ –ø—Ä–∏ DEV_ALLOW_UNSAFE=false ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        const me = await res.json();
        if (!me || me.role !== "admin") {
          window.location.replace("/staff");
        }
      } catch(_) {}
    }

    guard();
  })();
  </script>
</head>

<body>
  <div class="container">
    <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
    <div id="userInfo" class="note"></div>

    <section id="suppliersSection">
      <h2>–ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</h2>
      <div id="suppliersList">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      <form id="newSupplierForm">
        <input type="text" id="supplierName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞" required />
        <input type="text" id="supplierContact" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç / –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ" />
        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
      </form>
    </section>

    <hr />

    <section id="productsSection">
      <h2>–¢–æ–≤–∞—Ä—ã</h2>
      <div id="productsList">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      <form id="newProductForm">
        <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required />
        <input type="text" id="productUnit" placeholder="–ï–¥. –∏–∑–º. (—à—Ç, –∫–≥‚Ä¶)" />
        <input type="text" id="productCategory" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" value="–û–±—â–µ–µ" />
        <select id="productSupplier"></select>
        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
      </form>
    </section>

    <hr />

    <section id="requisitionsSection">
      <h2>–ó–∞—è–≤–∫–∏</h2>
      <div id="requisitionsList">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      <div id="requisitionDetail" style="display:none"></div>
    </section>
  </div>

  <script src="./shared.js"></script>
  <script src="./admin.js"></script>
</body>
</html>
